---
description: 删除死代码并合并重复项
agent: refactor-cleaner
subtask: true
---

# 重构清理命令

分析和清理代码库：$ARGUMENTS

## 你的任务

1. 使用分析工具**检测死代码**
2. **识别重复项**和合并机会
3. **安全删除**未使用的代码并记录
4. **验证**没有破坏功能

## 检测阶段

### 运行分析工具

```bash
# 查找未使用的导出
npx knip

# 查找未使用的依赖
npx depcheck

# 查找未使用的 TypeScript 导出
npx ts-prune
```

### 手动检查

- 未使用的函数（没有调用者）
- 未使用的变量
- 未使用的导入
- 注释掉的代码
- 不可达代码
- 未使用的 CSS 类

## 删除阶段

### 删除之前

1. **搜索使用情况** - grep，查找引用
2. **检查导出** - 可能被外部使用
3. **验证测试** - 没有测试依赖它
4. **记录删除** - git commit 消息

### 安全删除顺序

1. 先删除未使用的导入
2. 删除未使用的私有函数
3. 删除未使用的导出函数
4. 删除未使用的类型/接口
5. 删除未使用的文件

## 合并阶段

### 识别重复项

- 有细微差异的相似函数
- 复制粘贴的代码块
- 重复的模式

### 合并策略

1. **提取工具函数** - 用于重复逻辑
2. **创建基类** - 用于相似类
3. **使用高阶函数** - 用于重复模式
4. **创建共享常量** - 用于魔法数字

## 验证

清理之后：

1. `npm run build` - 构建成功
2. `npm test` - 所有测试通过
3. `npm run lint` - 没有新的 lint 错误
4. 手动冒烟测试 - 功能正常工作

## 报告格式

```
死代码分析
=================

已删除：
- file.ts: functionName（未使用的导出）
- utils.ts: helperFunction（没有调用者）

已合并：
- formatDate() 和 formatDateTime() → dateUtils.format()

待处理（需要人工审查）：
- oldComponent.tsx：可能未使用，与团队确认
```

---

**注意**：删除前务必验证。如有疑问，请询问或添加 `// TODO: verify usage` 注释。
